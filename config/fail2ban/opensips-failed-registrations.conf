# Fail2ban filter for OpenSIPS failed registration attempts
# Monitors OpenSIPS logs for failed registration attempts (403 Forbidden and other failures)
# This filter detects brute force registration attacks

[Definition]

# Failregex patterns to match failed registration log entries
# Log format: "REGISTER: Failed registration logged to database - user@domain from IP:PORT, response CODE REASON"
# Example: "REGISTER: Failed registration logged to database - 1001@example.com from 192.168.1.100:5060, response 403 Forbidden"

failregex = ^.*REGISTER: Failed registration logged to database - .* from <HOST>:\d+, response \d+ .*$
            ^.*REGISTER: Failed registration logged to database - .* from <HOST>:\d+, response 403 .*$
            ^.*REGISTER: Failed registration logged to database - .* from <HOST>:\d+, response 4\d{2} .*$
            ^.*REGISTER: Failed registration logged to database - .* from <HOST>:\d+, response 5\d{2} .*$

# Ignore 401 Unauthorized (normal part of authentication flow)
ignoreregex = ^.*REGISTER: Failed registration logged to database - .* from <HOST>:\d+, response 401 .*$

# Date/time pattern (OpenSIPS default log format)
# OpenSIPS logs typically include timestamp, adjust if your log format differs
# Common formats:
# - Syslog: "Jan 15 10:30:45 hostname opensips: ..."
# - Custom: Check your OpenSIPS log format
# This pattern should match your actual log format
datepattern = {^LN-BEG}%%Y-%%m-%%d %%H:%%M:%%S

# Notes:
# - <HOST> is a Fail2ban placeholder that matches IP addresses (IPv4 and IPv6)
# - The filter will match any failed registration (403, 4xx, 5xx) except 401
# - Adjust datepattern to match your actual OpenSIPS log format
# - If using syslog, you may need to adjust the datepattern or use syslog-specific patterns
